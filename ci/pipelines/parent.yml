resources:
  - name: home
    type: git
    source:
      uri: https://github.com/bakunowski/concourse-testing
      username: bakunowski
      password: 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

jobs:
- name: update-all-pipelines
  plan:
  - get: home
    trigger: true
  - load_var: config
    file: home/jobs.yml
  - across:
    - var: job
      values: ((.:config.jobs))
    do:
    - set_pipeline: ((.:job.name))
      file: home/ci/pipelines/pr-parent.yml
      vars:
        repo-name: ((.:job.name))
        pipeline: child.yml
      instance_vars:
        purpose: update-pr-pipelines
    - set_pipeline: ((.:job.name))
      file: home/ci/pipelines/((.:job.head-job))
      instance_vars:
        purpose: master ci
